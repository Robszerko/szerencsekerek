<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Békebeli Szerencsekerék</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Shrikhand&family=Roboto+Slab:wght@400;700&family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-wood: #6f4e37;
            --bg-dark-wood: #3d2b1f;
            --screen-blue: #0f4c75;
            --tile-green: #1b262c;
            --font-color-light: #f4e9d8;
            --font-color-dark: #323232;
            --gold-color: #f7b733;
            --pointer-red: #d92027;
            --tile-border-color: #7D9D9C;
        }

        body {
            background-color: var(--bg-dark-wood);
            background-image: linear-gradient(45deg, #3a2220 25%, transparent 25%), linear-gradient(-45deg, #3a2220 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #3a2220 75%), linear-gradient(-45deg, transparent 75%, #3a2220 75%);
            background-size: 20px 20px;
            font-family: 'Roboto Slab', serif;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            text-rendering: optimizeLegibility;
        }

        header {
            width: 100%;
            max-width: 1400px;
            padding-bottom: 20px;
            text-align: center;
        }
        
        #logo-container {
            width: clamp(320px, 40vw, 550px);
            margin: 0 auto;
        }

        #logo-svg {
            width: 100%;
            height: auto;
            filter: drop-shadow(3px 3px 4px #000);
        }

        #tv-container {
            width: 100%;
            max-width: 1400px;
            background-color: #5a3825;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.02) 10px, rgba(255,255,255,0.02) 20px),
                linear-gradient(to bottom, #5a3825, #4a2c2a);
            border: 15px solid var(--bg-dark-wood);
            border-radius: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 15px rgba(0,0,0,0.5);
            padding: 25px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        #screen {
            background-color: #1f2833;
            border-radius: 20px;
            box-shadow: inset 0 0 25px rgba(0,0,0,0.9);
            width: 100%;
            padding: clamp(10px, 2vw, 20px);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
            overflow: hidden;
        }

        #screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: repeating-linear-gradient(rgba(0, 0, 0, 0.2) 0, rgba(0, 0, 0, 0.2) 2px, transparent 2px, transparent 4px);
            pointer-events: none;
            z-index: 1;
        }
        
        #game-area {
            display: flex;
            gap: 20px;
            flex-grow: 1;
            position: relative;
            z-index: 2;
        }

        #puzzle-section {
            flex: 3;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        #puzzle-category {
            background-color: rgba(0,0,0,0.3);
            color: var(--font-color-light);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: clamp(1rem, 2vw, 1.5rem);
            border: 2px solid var(--gold-color);
            font-weight: 700;
            text-transform: uppercase;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #puzzle-board {
            display: flex;
            flex-direction: column;
            gap: 5px;
            width: 100%;
        }
        .puzzle-row {
            display: flex;
            justify-content: center;
            gap: 5px;
            width: 100%;
        }
        .puzzle-tile {
            width: clamp(35px, 5.5vw, 50px);
            height: clamp(45px, 7vw, 65px);
            perspective: 1000px;
        }
        
        .tile-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .puzzle-tile.revealed .tile-inner {
            transform: rotateY(180deg);
        }
        
        .tile-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 5px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }
        
        .tile-front {
            background-color: var(--tile-green);
            border: 2px solid var(--tile-border-color);
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5), 0 0 4px rgba(125, 157, 156, 0.4);
        }
        .tile-back {
            background-color: var(--font-color-light);
            color: var(--font-color-dark);
            font-weight: 700;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            transform: rotateY(180deg);
            text-shadow: 1px 1px 2px var(--gold-color);
        }
        .puzzle-tile.space {
             background-color: transparent;
             box-shadow: none;
             border: none;
        }
        .puzzle-tile.space .tile-inner {
             display: none;
        }


        #alphabet-panel {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            background-color: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 10px;
        }
        .alphabet-key {
            width: 35px;
            height: 35px;
            font-family: 'Roboto Slab', serif;
            font-weight: 700;
            font-size: 1rem;
            border: 1px solid var(--bg-dark-wood);
            border-bottom: 3px solid var(--bg-dark-wood);
            border-right: 3px solid var(--bg-dark-wood);
            border-radius: 5px;
            cursor: pointer;
            background-color: var(--font-color-light);
            color: var(--font-color-dark);
            box-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            transition: all 0.1s ease;
        }
        .alphabet-key.vowel {
            border-color: #2196f3;
            border-bottom-color: #1565c0;
            border-right-color: #1565c0;
        }
        .alphabet-key:hover:not(:disabled) {
            background-color: var(--gold-color);
        }
        .alphabet-key:active:not(:disabled) {
            transform: translateY(2px);
            border-bottom-width: 1px;
            border-right-width: 1px;
        }
        .alphabet-key:disabled {
            background-color: #616161;
            color: #bdbdbd;
            cursor: not-allowed;
            opacity: 0.7;
        }

        #game-controls-section {
            flex: 2;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            gap: 15px;
        }

        #wheel-wrapper {
            position: relative;
            width: clamp(280px, 40vh, 380px);
            aspect-ratio: 1 / 1;
        }

        #wheel-pointer {
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid var(--pointer-red);
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.5));
            border-radius: 3px;
            background: linear-gradient(to top, #c01a21, #f02e35);
            border-top: 30px solid #d92027;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            box-shadow: inset 0 2px 2px rgba(255,255,255,0.4);
        }
        
        #wheel {
            width: 100%;
            height: 100%;
            transition: transform 5s cubic-bezier(0.2, 0.8, 0.25, 1);
            filter: drop-shadow(3px 3px 5px rgba(0,0,0,0.5));
            border-radius: 50%;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.7);
        }

        #player-hud {
            text-align: center;
        }
        .hud-label {
            font-size: clamp(1rem, 2vw, 1.2rem);
            color: var(--font-color-light);
            font-weight: 700;
        }
        #score-display-container {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0,0,0,0.3);
            padding: 5px 20px;
            border-radius: 10px;
            margin-top: 5px;
            border: 2px solid var(--gold-color);
        }
        #score-display {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            color: var(--gold-color);
            font-weight: 700;
            text-shadow: 2px 2px 2px #000;
        }
        #round-display {
            font-size: 1rem;
            font-weight: 700;
            color: var(--font-color-light);
        }
        
        #host-message {
            background: rgba(0,0,0,0.2);
            border: 2px solid rgba(244, 233, 216, 0.5);
            color: white;
            padding: 10px;
            border-radius: 10px;
            min-height: 4em;
            text-align: center;
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 400px;
        }
        #host-message strong { color: var(--gold-color); }

        #power-meter-container {
            width: 90%;
            max-width: 350px;
            height: 25px;
            background-color: var(--bg-dark-wood);
            border: 3px solid #f4e9d8;
            border-radius: 10px;
            overflow: hidden;
            padding: 3px;
        }
        #power-meter-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #ffeb3b, #f44336);
            border-radius: 5px;
        }
        #power-meter-bar.power-up {
            animation: power-up-anim 1.5s linear infinite;
        }
        @keyframes power-up-anim {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        #action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            width: 100%;
            flex-wrap: wrap;
        }
        .action-btn {
            padding: 12px 15px;
            font-family: 'Roboto Slab', serif;
            font-weight: 700;
            font-size: clamp(0.8rem, 2vw, 1rem);
            border-radius: 8px;
            border: 1px solid var(--bg-dark-wood);
            border-bottom: 4px solid var(--bg-dark-wood);
            box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
            cursor: pointer;
            transition: all 0.1s ease;
            text-transform: uppercase;
            flex-grow: 1;
            max-width: 150px;
        }
        .action-btn:hover:not(:disabled) { filter: brightness(1.1); }
        .action-btn:active:not(:disabled) { transform: translateY(3px); border-bottom-width: 1px; }
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        #spin-button { background-color: #4caf50; color: white; }
        #solve-button { background-color: var(--gold-color); color: var(--font-color-dark); }
        #new-game-button { background-color: #607d8b; color: white; margin-top: 10px; width: 100%; max-width: 310px;}
        
        #wait-screen {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            min-height: 250px;
            background-color: rgba(0,0,0,0.3);
            border: 2px dashed var(--gold-color);
            border-radius: 10px;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
            color: var(--font-color-light);
        }
        #wait-message {
            font-size: 1.2rem;
            font-style: italic;
            margin-bottom: 25px;
        }
        #next-puzzle-time {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--gold-color);
            text-shadow: 2px 2px 2px #000;
        }


        @media (max-width: 900px) {
            body { height: auto; }
            #game-area { flex-direction: column; align-items: center; }
            #game-controls-section { flex-direction: column; width: 100%; max-width: 400px; }
            #puzzle-board, .puzzle-row { gap: 3px; }
            .puzzle-tile { width: clamp(25px, 6vw, 40px); height: clamp(35px, 8vw, 52px); }
            .tile-back { font-size: clamp(1rem, 4.5vw, 2rem); }
        }
    </style>
</head>
<body>
    <header>
        <div id="logo-container">
            <svg id="logo-svg" viewBox="0 0 500 150">
                <defs>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Bevan&display=swap');
                    </style>
                    <linearGradient id="chromeGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#d0d0d0; stop-opacity:1" /><stop offset="30%" style="stop-color:#f0f0f0; stop-opacity:1" /><stop offset="50%" style="stop-color:#a0a0a0; stop-opacity:1" /><stop offset="100%" style="stop-color:#707070; stop-opacity:1" /></linearGradient>
                    <linearGradient id="goldGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#fff2a8; stop-opacity:1" /><stop offset="50%" style="stop-color:#f7b733; stop-opacity:1" /><stop offset="100%" style="stop-color:#e69a00; stop-opacity:1" /></linearGradient>
                    <filter id="glow"><feGaussianBlur stdDeviation="3.5" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                </defs>
                <text x="250" y="70" font-family="'Great Vibes', cursive" font-size="65" fill="url(#goldGradient)" text-anchor="middle" stroke="#412A18" stroke-width="1" filter="url(#glow)">Békebeli</text>
                <text x="250" y="120" font-family="'Bevan', cursive" font-size="42" fill="#1E1E1E" text-anchor="middle" transform="translate(4, 4)" opacity="0.6" letter-spacing="2">SZERENCSEKERÉK</text>
                <text x="250" y="120" font-family="'Bevan', cursive" font-size="42" fill="url(#chromeGradient)" stroke="#222" stroke-width="1.5" text-anchor="middle" letter-spacing="2">SZERENCSEKERÉK</text>
                <text x="250" y="120" font-family="'Bevan', cursive" font-size="42" fill="white" opacity="0.4" text-anchor="middle" letter-spacing="2" clip-path="polygon(0 0, 100% 0, 100% 45%, 0 45%)">SZERENCSEKERÉK</text>
            </svg>
        </div>
    </header>
    <div id="tv-container">
        <div id="screen">
            <div id="game-area">
                <section id="puzzle-section">
                    <div id="puzzle-category"></div>
                    <div id="puzzle-area-container" style="width:100%;">
                        <div id="puzzle-board"></div>
                        <div id="wait-screen">
                            <div id="wait-message"></div>
                            <div id="next-puzzle-time"></div>
                        </div>
                    </div>
                    <div id="alphabet-panel"></div>
                </section>
                <section id="game-controls-section">
                    <div id="player-hud">
                        <div class="hud-label">Teljes Nyeremény</div>
                        <div id="score-display-container">
                            <div id="score-display">0 pont</div>
                            <div id="round-display"></div>
                        </div>
                    </div>
                    <div id="wheel-wrapper">
                        <div id="wheel-pointer"></div>
                        <svg id="wheel" viewBox="0 0 100 100"></svg>
                    </div>
                    <div id="power-meter-container">
                        <div id="power-meter-bar"></div>
                    </div>
                    <div id="host-message">Üdvözlöm a stúdióban! Kezdéshez pörgessen egyet!</div>
                    <div id="action-buttons">
                        <button id="spin-button" class="action-btn">Pörgetés</button>
                        <button id="solve-button" class="action-btn">Megfejtem</button>
                        <button id="new-game-button" class="action-btn">Új Játék</button>
                    </div>
                </section>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // A TE SAJÁT LINKED BEILLESZTVE
        const GITHUB_PUZZLE_URL = 'https://raw.githubusercontent.com/Robszerko/szerencsekerek/refs/heads/main/feladvanyok.js'; 

        const VOWELS = "AÁEÉIÍOÓÖŐUÚÜŰ";
        const FULL_ALPHABET = "AÁBCDEÉFGHIÍJKLMNOÓÖŐPQRSTUÚÜŰVXYZ";
        const VOWEL_COST = 250;
        const HOURLY_PUZZLE_COUNT = 10;
        
        const WAITING_MESSAGES = [ "A stúdiót épp szellőztetik, addig menjen, igyon egy Márka-meggyet!", "Adásszünet! A műsorvezetők épp lángost esznek a büfében.", "Technikai szünet. A technikus épp visszatekeri a ceruzával a kazettát.", "Ön egy zseni! Pihenjen egy órát, megérdemli. Addig mi új tupírt teszünk a hajunkba.", "Mára ennyi volt a fejtörés, a stúdió elment szinkronúszni.", "Minden feladványt megoldott! Ön egy agytröszt! A következő adagig hallgasson egy kis Neoton Famíliát!", "Elfogyott a feladvány, mint a banán a boltból '86-ban. Várjon a következő szállítmányra!", "Gratulálunk! Most pihenésképp nézzen meg egy részt a Szomszédokból.", "A betűfal most pihen. Próbálja meg egy óra múlva, hátha addigra felébred.", "Ön gyorsabb volt, mint a moncsicsi-divat! A következő adagig olvasson el egy Pajtás újságot!", "A műsorvezető elment megnézni, van-e még jégen csúszkálás a tévében. Hamarosan visszajön.", "Minden rejtvény megfejtve! Ön olyan okos, mint a Szokol rádió!", "Pillanat, a stúdióasszisztens épp új csillámokat szór a kerékre.", "Kis türelmet, a betűk épp szakszervezeti gyűlést tartanak.", "Mára végzett! A jutalma egy virtuális Balaton szelet. A következő feladványokig jó étvágyat!", "Hoppá! Kiürült a rejtvénytár! A következő adag a Varsói Szerződés következő ülésén érkezik.", "A stáb most egy kis csocsó-bajnokságot tart. Egy óra múlva folytatjuk!", "Ön olyan népszerű, mint a Dallas! De most szünet következik.", "Minden megfejtve! A stúdióban álló tapsvihar hallatszik. Pihenjen egyet, bajnok!", "A betűk elmentek ebédelni. Jöjjön vissza később egy jó fröccs után!" ];
        const HOST_MESSAGES = { loading: ["A feladvány-adatbázist töltjük a nagyvilágból... kis türelmet!", "Kapcsoljuk a központi rejtvény-elosztót... pillanat!", "Keressük a mai napi feladványokat a digitális éterben..."], start_game: ["Hölgyeim és Uraim, kezdődjön a játék! Lássuk az első feladványt!", "A stúdió fényei kigyúltak, a kerék készen áll! Sok szerencsét!", "A hajszárítók zúgnak, a tupírok tartanak, a Szerencsekerék pedig forogni készül! Induljon a menet!", "Szervusz, kedves játékos! A mai főnyeremény egy Trabant tele... reménnyel! Vágjunk is bele!", "Bekapcsoltuk a Videoton tévét, beállítottuk az adást, kezdődjön a szerencsevadászat!", "A stúdióban Fabulon-illat és izgalom terjeng. Vágjunk is bele!"], start_round: ["Jöhet a(z) <strong>{round}. feladvány</strong>! A tét nem változik, csak a kihívás!", "Lássuk a következő feladványt a mai csomagból!", "Újabb fejtörő! Ön még mindig versenyben van a napi fődíjért!", "Lássuk a <strong>{round}. feladványt</strong>! A stúdió feszülten figyel!", "A következő rejtvény, mint egy jó C-vitamin, felfrissíti az agyat!"], power_up: ["Induljon a pörgetés! Állítsa be az erősséget!", "Na lássuk, mekkorát lendít rajta!", "Mutassa meg, mekkora erő lakozik a csuklójában!", "Lendületet kérek! Pörgessünk, mintha nem lenne holnap!", "Adjon neki kakaót, ahogy a könyvben meg van írva!", "Lendítse meg, mint a Linda a rosszfiúkat!"], spinning: ["A kerék forog, a kassza csörög!", "Lássuk, hol áll meg a szerencse-", "Forog a kerék, szól a Zoltán Erika!"], spin_result: ["A pörgetés értéke <strong>{value} pont</strong>. Most jöhet egy mássalhangzó!", "<strong>{value} pont</strong> a tét! Melyik betűre gondol?", "A kerék <strong>{value}</strong> forintot... azaz pontot mutat! Mondjon egy mássalhangzót, de ne a 'Dz'-t!", "Ez egy szép summa: <strong>{value}</strong> pont! Egy betűt kérek, de gyorsan, mielőtt a rendező kávészünetet rendel el!", "Remek, <strong>{value}</strong> pont! Ezért már egy Trapper farmert is adnának! Melyik betű lesz az?", "Ez <strong>{value}</strong> pont! Ebből már kijön egy jó lángos a Római-parton! Halljuk a tippet!"], bankrupt: ["Jaj, ne! <strong>CSŐD!</strong> A fordulós kassza most sírva fakad, a pontok elúsznak!", "Ez a legrosszabb mező! A csőd mindent vitt ebben a körben!", "Leégett a biztosíték! A <strong>CSŐD</strong> mindent vitt, de a jókedvünket nem viheti!", "Ó, a frász! Ez a fekete mező! A pontok elszálltak, mint a novemberi köd!", "Jaj, a nagy fekete semmi! A pontok mentek a levesbe, mint a nokedli!", "Mint a rosszul felvett kazetta, a fordulós pontoknak annyi! Sajnálom!"], lose_turn: ["<strong>KIMARADSZ!</strong> Egy pillanatnyi pihenő!", "Most sajnos át kell adnia a lehetőséget.", "Hoppá, egy kis pihenő! Most a többiek jönnek, de ne csüggedjen!", "Átadja a stafétát, mint a Vitray a Híradóban!"], correct_consonant: ["Zseniális! Van <strong>{count}</strong> darab, ez <strong>{earnings} pontot</strong> ér! Ismét ön jön!", "Eltalálta! <strong>{count}</strong> betű, <strong>{earnings} pont</strong>! Folytassa!", "Ott van, ni! <strong>{count}</strong> darab, mint a jó csoki a KGST-piacon! Ez <strong>{earnings} pontot</strong> ér!", "Bingó! Eltalálta! <strong>{count}</strong> darab, amiért <strong>{earnings}</strong> pont a jutalma!", "Ez 'tutkeráj'! <strong>{count}</strong> darab, amiért <strong>{earnings}</strong> pont a jutalma! Ön egy észkombájn!", "Telitalálat! <strong>{count}</strong> betű, <strong>{earnings}</strong> pont! Frankó!"], correct_vowel: ["Igen, van <strong>{count}</strong> darab! A kör folytatódik.", "Jól gondolta, a táblán van <strong>{count}</strong> ilyen betű!", "A magánhangzó a helyén! A megfejtés már dereng, mint egy Pannónia lámpája!", "Megvan! A magánhangzó a helyén, mint Vágási Feri a számítógép előtt!"], wrong_letter: ["Sajnálom, de ez a betű nincs a feladványban.", "Ez most nem jött be. A következő pörgetésig várnia kell.", "Sajnos ez a betű most szabadságon van.", "A betűfal nemet intett. Sebaj!", "Ez a betű most a presszóban kávézik, nincs itt.", "Sajnos ez a tipp most mellément, mint egy rossz vicc."], solve_success: ["<strong>MEGFEJTÉS!</strong> Gratulálok, ez a helyes megoldás!", "Kiváló! Pontosan ez volt a feladvány!", "Ez az! Megvan a megfejtés! Ön egy igazi fejtörő-fenomén!", "És a helyes megfejtés... PONTOSAN EZ! Hatalmas tapsot!", "Le a kalappal! Ez a helyes megfejtés!", "Megvan! Ön egy agytröszt! A megfejtés helyes, a stúdió tombol!"], turn_end: ["Újra önnél a lehetőség! Pörgessen, vagy vegyen magánhangzót!", "Lássuk a következő lépést! Pörget vagy vásárol?", "Ismét öné a terep! Mutassa meg, mit tud!", "Önnél a labda! Pörgetés vagy vásárlás?"]};

        let gameState;
        let fullPuzzleDatabase = [];
        let hourlyPuzzles = [];
        
        const wheel = document.getElementById('wheel');
        const spinButton = document.getElementById('spin-button');
        const solveButton = document.getElementById('solve-button');
        const newGameButton = document.getElementById('new-game-button');
        const puzzleBoard = document.getElementById('puzzle-board');
        const puzzleCategory = document.getElementById('puzzle-category');
        const scoreDisplay = document.getElementById('score-display');
        const roundDisplay = document.getElementById('round-display');
        const hostMessage = document.getElementById('host-message');
        const alphabetPanel = document.getElementById('alphabet-panel');
        const powerMeterBar = document.getElementById('power-meter-bar');
        
        const puzzleAreaContainer = document.getElementById('puzzle-area-container');
        const waitScreen = document.getElementById('wait-screen');
        const waitMessage = document.getElementById('wait-message');
        const nextPuzzleTime = document.getElementById('next-puzzle-time');

        function resetGameState(isNewGame = false) {
             const savedScore = localStorage.getItem('totalPlayerScore') || '0';
             const savedProgress = localStorage.getItem('hourlyPuzzleProgress') || '0';
            gameState = { playerScore: isNewGame ? 0 : parseInt(savedScore, 10), roundStartScore: 0, currentPuzzleIndex: isNewGame ? 0 : parseInt(savedProgress, 10), currentSpinValue: null, isSpinning: false, isPoweringUp: false, awaitingConsonant: false, isExpressTurn: false, freeVowels: 0, guessedLetters: [] };
            localStorage.setItem('totalPlayerScore', gameState.playerScore);
            localStorage.setItem('hourlyPuzzleProgress', gameState.currentPuzzleIndex);
        }

        async function initGame() {
            updateHostMessage(getRandomMessage('loading'));
            try {
                const response = await fetch(GITHUB_PUZZLE_URL);
                if (!response.ok) { throw new Error(`HTTP hiba! Státusz: ${response.status}`); }
                const text = await response.text();
                const script = document.createElement('script');
                script.textContent = text;
                document.head.appendChild(script);
                fullPuzzleDatabase = window.feladvanyok || []; 
                script.remove();
                if(fullPuzzleDatabase.length < HOURLY_PUZZLE_COUNT){
                    updateHostMessage("Hiba: Nincs elég feladvány az adatbázisban!", true);
                    return;
                }
                checkHourlyStatus();
            } catch (error) {
                console.error("Hiba a feladványok betöltésekor:", error);
                updateHostMessage("Hiba történt a feladvány-adatbázis elérésekor!", true);
            }
        }
        
        function checkHourlyStatus() {
            const lastCompletedHourUTC = localStorage.getItem('lastCompletedHourUTC');
            const currentHourUTC = new Date().toISOString().slice(0, 13);
            if (lastCompletedHourUTC === currentHourUTC) {
                showWaitForNextHourScreen();
            } else {
                hourlyPuzzles = generateHourlyPuzzles();
                startHourlyRound();
            }
        }

        function showWaitForNextHourScreen() {
            puzzleBoard.style.display = 'none';
            alphabetPanel.style.display = 'none';
            waitScreen.style.display = 'flex';
            puzzleCategory.style.display = 'none';
            spinButton.disabled = true;
            solveButton.disabled = true;
            const nextHour = new Date();
            nextHour.setHours(nextHour.getHours() + 1, 0, 0, 0);
            waitMessage.innerHTML = WAITING_MESSAGES[Math.floor(Math.random() * WAITING_MESSAGES.length)];
            nextPuzzleTime.innerHTML = `A következő feladványcsomag <strong>${nextHour.getHours()}:00</strong> órakor érkezik!`;
            updateHostMessage("Pihenő! Jöjjön vissza később a folytatásért!");
        }

        function generateHourlyPuzzles() {
            const now = new Date();
            const seed = now.getUTCFullYear() * 1000000 + (now.getUTCMonth() + 1) * 10000 + now.getUTCDate() * 100 + now.getUTCHours();
            let m_w = seed;
            let m_z = 987654321;
            const mask = 0xffffffff;
            function seededRandom() {
                m_z = (36969 * (m_z & 65535) + (m_z >> 16)) & mask;
                m_w = (18000 * (m_w & 65535) + (m_w >> 16)) & mask;
                let result = ((m_z << 16) + m_w) & mask;
                result /= 4294967296;
                return result + 0.5;
            }
            const indices = new Set();
            while (indices.size < HOURLY_PUZZLE_COUNT && indices.size < fullPuzzleDatabase.length) {
                const index = Math.floor(seededRandom() * fullPuzzleDatabase.length);
                indices.add(index);
            }
            return Array.from(indices).map(index => fullPuzzleDatabase[index]);
        }
        
        function startHourlyRound(isNewGame = false) {
             if (isNewGame) {
                localStorage.removeItem('totalPlayerScore');
                localStorage.removeItem('hourlyPuzzleProgress');
                localStorage.removeItem('lastCompletedHourUTC');
                checkHourlyStatus();
                return;
            }
            resetGameState();
            const puzzleIndex = gameState.currentPuzzleIndex;
            if (puzzleIndex >= HOURLY_PUZZLE_COUNT || !hourlyPuzzles || hourlyPuzzles.length === 0) {
                const currentHourUTC = new Date().toISOString().slice(0, 13);
                localStorage.setItem('lastCompletedHourUTC', currentHourUTC);
                showWaitForNextHourScreen();
                return;
            }
            puzzleBoard.style.display = 'flex';
            alphabetPanel.style.display = 'flex';
            waitScreen.style.display = 'none';
            puzzleCategory.style.display = 'flex';
            gameState.guessedLetters = [];
            gameState.roundStartScore = gameState.playerScore;
            const currentPuzzle = hourlyPuzzles[puzzleIndex];
            setupPuzzleBoard(currentPuzzle);
            createAlphabetPanel();
            updateUI();
            updateHostMessage(getRandomMessage('start_round', { round: puzzleIndex + 1 }));
        }

        function setupPuzzleBoard(puzzleData) {
            if (!puzzleData) {
                console.error("Hiba: Nem található feladvány.");
                showWaitForNextHourScreen();
                return;
            }
            puzzleCategory.textContent = puzzleData.category;
            puzzleBoard.innerHTML = '';
             const words = puzzleData.puzzle.toUpperCase().split(' ');
            const rows = [];
            let currentRow = [];
            let currentLength = 0;
            words.forEach(word => {
                if (currentLength + word.length > 14 && currentRow.length > 0) {
                    rows.push(currentRow);
                    currentRow = [];
                    currentLength = 0;
                }
                currentRow.push(word);
                currentLength += word.length + 1;
            });
            rows.push(currentRow);
            rows.forEach(wordArray => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'puzzle-row';
                wordArray.forEach((word, wordIndex) => {
                    word.split('').forEach(char => {
                        const tile = document.createElement('div');
                        tile.className = 'puzzle-tile';
                        tile.innerHTML = `<div class="tile-inner"><div class="tile-face tile-front"></div><div class="tile-face tile-back">${char}</div></div>`;
                        tile.dataset.letter = char;
                        rowDiv.appendChild(tile);
                    });
                    if(wordIndex < wordArray.length - 1) {
                        const spaceTile = document.createElement('div');
                        spaceTile.className = 'puzzle-tile space';
                        rowDiv.appendChild(spaceTile);
                    }
                });
                puzzleBoard.appendChild(rowDiv);
            });
        }
        
        function updateUI() {
            scoreDisplay.textContent = `${gameState.playerScore} pont`;
            roundDisplay.textContent = `Feladvány: ${gameState.currentPuzzleIndex + 1}/${HOURLY_PUZZLE_COUNT}`;
            solveButton.disabled = gameState.isSpinning || gameState.awaitingConsonant;
            spinButton.disabled = gameState.isSpinning || gameState.awaitingConsonant || gameState.isExpressTurn;
            updateAlphabetPanel();
        }

        async function solvePuzzle(autoSolve = false) {
            const puzzleData = hourlyPuzzles[gameState.currentPuzzleIndex];
            let attempt = '';
            if (!autoSolve) {
                 try {
                    // A prompt egyszerűbb, de a modal jobb élményt adna
                    attempt = prompt("Megfejtés:");
                    if (attempt === null) return; // Mégse gomb
                } catch { return; }
            } else {
                attempt = puzzleData.puzzle;
            }

            if (attempt.toUpperCase().trim().replace(/\s+/g, ' ') === puzzleData.puzzle.toUpperCase()) {
                playSound('correct-sound');
                document.querySelectorAll('.puzzle-tile[data-letter]:not(.revealed)').forEach((tile, index) => {
                    setTimeout(() => tile.classList.add('revealed'), index * 50);
                });
                updateHostMessage(getRandomMessage('solve_success'));
                gameState.currentPuzzleIndex++;
                localStorage.setItem('hourlyPuzzleProgress', gameState.currentPuzzleIndex);
                localStorage.setItem('totalPlayerScore', gameState.playerScore);
                setTimeout(() => startHourlyRound(), 4000);
            } else {
                updateHostMessage("Sajnos ez nem a helyes megfejtés!", true);
                endTurn();
            }
        }
        
        function endTurn() {
            gameState.currentSpinValue = null;
            gameState.awaitingConsonant = false;
            gameState.isExpressTurn = false;
            setTimeout(() => {
                if (gameState.currentPuzzleIndex < HOURLY_PUZZLE_COUNT) {
                     updateHostMessage(getRandomMessage('turn_end'));
                }
                updateUI();
            }, 3500);
        }
        
        newGameButton.addEventListener('click', () => {
            if(confirm("Biztosan új játékot kezd? Ezzel a teljes pontszáma és a napi haladása is törlődik!")) {
                 startHourlyRound(true);
            }
        });
        
        function playSound(id) { const sound = document.getElementById(id); if (sound) { sound.currentTime = 0; sound.play().catch(e => console.log("Hiba a hanglejátszáskor:", e)); } }
        function getRandomMessage(category, replacements = {}) { const messages = HOST_MESSAGES[category]; let message = messages[Math.floor(Math.random() * messages.length)]; for (const key in replacements) { message = message.replace(new RegExp(`{${key}}`, 'g'), replacements[key]); } return message; }
        function createAlphabetPanel() { alphabetPanel.innerHTML = ''; FULL_ALPHABET.split('').forEach(letter => { const key = document.createElement('button'); key.className = 'alphabet-key'; key.textContent = letter; key.dataset.letter = letter; if (VOWELS.includes(letter)) key.classList.add('vowel'); key.addEventListener('click', () => handleLetterGuess(letter)); alphabetPanel.appendChild(key); }); }
        function updateAlphabetPanel() { document.querySelectorAll('.alphabet-key').forEach(key => { const letter = key.dataset.letter; const isVowel = VOWELS.includes(letter); key.disabled = gameState.guessedLetters.includes(letter) || gameState.isSpinning; if (!isVowel) { key.disabled = key.disabled || (!gameState.awaitingConsonant && !gameState.isExpressTurn); } else { key.disabled = key.disabled || gameState.awaitingConsonant || (gameState.playerScore < VOWEL_COST && gameState.freeVowels === 0); } }); }
        function polarToCartesian(cx, cy, r, angle) { const rad = (angle - 90) * Math.PI / 180.0; return { x: cx + (r * Math.cos(rad)), y: cy + (r * Math.sin(rad)) }; }
        function drawWheel() { const segments = [ { label: '300', value: 300, color: '#4caf50' }, { label: 'CSŐD', value: 'bankrupt', color: '#212121' }, { label: '500', value: 500, color: '#f44336' }, { label: '1000', value: 1000, color: '#9c27b0' }, { label: 'KIMARADSZ', value: 'lose_turn', color: '#607d8b' }, { label: '400', value: 400, color: '#ff9800' }, { label: '600', value: 600, color: '#3f51b5' }, { label: 'CSŐD', value: 'bankrupt', color: '#212121' }, { label: '700', value: 700, color: '#e91e63' }, { label: '350', value: 350, color: '#00bcd4' }, { label: '550', value: 550, color: '#8bc34a' }, { label: '2500', value: 2500, color: '#ffc107' } ]; wheel.innerHTML = ''; const numSegments = segments.length; const angleStep = 360 / numSegments; const radius = 50; const center = 50; for (let i = 0; i < numSegments; i++) { const segment = segments[i]; const startAngle = i * angleStep; const endAngle = (i + 1) * angleStep; const start = polarToCartesian(center, center, radius, endAngle); const end = polarToCartesian(center, center, radius, startAngle); const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1"; const d = `M ${start.x} ${start.y} A ${radius} ${radius} 0 ${largeArcFlag} 0 ${end.x} ${end.y} L ${center} ${center} Z`; const path = document.createElementNS("http://www.w3.org/2000/svg", "path"); path.setAttribute("d", d); path.setAttribute("fill", segment.color); path.setAttribute("stroke", "rgba(0,0,0,0.4)"); path.setAttribute("stroke-width", "0.5"); wheel.appendChild(path); const textAngle = startAngle + angleStep / 2; const textPos = polarToCartesian(center, center, radius * 0.7, textAngle); const text = document.createElementNS("http://www.w3.org/2000/svg", "text"); text.setAttribute("x", textPos.x); text.setAttribute("y", textPos.y); text.setAttribute("text-anchor", "middle"); text.setAttribute("dominant-baseline", "middle"); text.setAttribute("font-weight", "bold"); text.setAttribute("font-size", "4.8px"); text.setAttribute("fill", typeof segment.value === 'number' && segment.value < 5000 ? '#111' : 'white'); text.setAttribute("transform", `rotate(${textAngle + 90} ${textPos.x} ${textPos.y})`); text.textContent = segment.label; wheel.appendChild(text); } }
        function togglePowerMeter() { if (gameState.isSpinning || gameState.awaitingConsonant) return; if (!gameState.isPoweringUp) { gameState.isPoweringUp = true; powerMeterBar.classList.add('power-up'); updateHostMessage(getRandomMessage('power_up')); spinButton.textContent = "MEGÁLLÍT"; } else { gameState.isPoweringUp = false; powerMeterBar.classList.remove('power-up'); const power = powerMeterBar.offsetWidth / powerMeterBar.parentElement.offsetWidth; powerMeterBar.style.width = `${power * 100}%`; spinButton.textContent = "PÖRGETÉS"; spinWheel(power); } }
        function spinWheel(power) { if (gameState.isSpinning) return; gameState.isSpinning = true; gameState.currentSpinValue = null; updateUI(); updateHostMessage(getRandomMessage('spinning')); playSound('spin-sound'); const baseRotations = 3; const powerRotation = power * 4; const randomExtraRotation = Math.random(); const totalRotation = (baseRotations + powerRotation + randomExtraRotation) * 360; const currentRotation = parseFloat(wheel.dataset.rotation || 0); const newRotation = currentRotation + totalRotation; wheel.style.transform = `rotate(${newRotation}deg)`; wheel.dataset.rotation = newRotation; setTimeout(() => { gameState.isSpinning = false; const segments = [ { label: '300', value: 300 }, { label: 'CSŐD', value: 'bankrupt' }, { label: '500', value: 500 }, { label: '1000', value: 1000 }, { label: 'KIMARADSZ', value: 'lose_turn' }, { label: '400', value: 400 }, { label: '600', value: 600 }, { label: 'CSŐD', value: 'bankrupt' }, { label: '700', value: 700 }, { label: '350', value: 350 }, { label: '550', value: 550 }, { label: '2500', value: 2500 } ]; const finalAngle = newRotation % 360; const segmentAngle = 360 / segments.length; const segmentIndex = Math.floor((360 - finalAngle % 360) / segmentAngle); const result = segments[segmentIndex]; handleSpinResult(result); powerMeterBar.style.width = '0%'; }, 5000); }
        function handleSpinResult(result) { gameState.awaitingConsonant = false; switch(result.value) { case 'bankrupt': playSound('bankrupt-sound'); updateHostMessage(getRandomMessage('bankrupt'), true); gameState.playerScore = gameState.roundStartScore; localStorage.setItem('totalPlayerScore', gameState.playerScore); endTurn(); break; case 'lose_turn': updateHostMessage(getRandomMessage('lose_turn'), true); endTurn(); break; default: gameState.currentSpinValue = result.value; gameState.awaitingConsonant = true; updateHostMessage(getRandomMessage('spin_result', {value: result.value}), true); updateUI(); break; } }
        function handleLetterGuess(letter) { if (gameState.guessedLetters.includes(letter) || document.querySelector(`.alphabet-key[data-letter="${letter}"]`).disabled) return; const isVowel = VOWELS.includes(letter); if (isVowel) { if(gameState.freeVowels > 0) { gameState.freeVowels--; } else { gameState.playerScore -= VOWEL_COST; } } gameState.guessedLetters.push(letter); const currentPuzzle = hourlyPuzzles[gameState.currentPuzzleIndex].puzzle.toUpperCase(); const foundCount = (currentPuzzle.match(new RegExp(letter, "g")) || []).length; if (foundCount > 0) { playSound('correct-sound'); document.querySelectorAll(`.puzzle-tile[data-letter="${letter}"]`).forEach(tile => tile.classList.add('revealed')); if (isVowel) { updateHostMessage(getRandomMessage('correct_vowel', {count: foundCount})); } else { const earnings = foundCount * gameState.currentSpinValue; gameState.playerScore += earnings; updateHostMessage(getRandomMessage('correct_consonant', {count: foundCount, earnings: earnings})); if (!gameState.isExpressTurn) gameState.awaitingConsonant = false; } localStorage.setItem('totalPlayerScore', gameState.playerScore); } else { updateHostMessage(getRandomMessage('wrong_letter')); endTurn(); } if (document.querySelectorAll('.puzzle-tile[data-letter]:not(.space .tile-inner)').length === document.querySelectorAll('.puzzle-tile.revealed').length) { setTimeout(() => solvePuzzle(true), 1000); } else { updateUI(); } }
        
        spinButton.addEventListener('click', togglePowerMeter);
        solveButton.addEventListener('click', () => solvePuzzle(false));
        drawWheel();
        initGame();

    });
    </script>
</body>
</html>
