<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√©kebeli Szerencseker√©k</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Shrikhand&family=Roboto+Slab:wght@400;700&family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-wood: #6f4e37;
            --bg-dark-wood: #3d2b1f;
            --screen-blue: #0f4c75;
            --tile-green: #1b262c;
            --font-color-light: #f4e9d8;
            --font-color-dark: #323232;
            --gold-color: #f7b733;
            --pointer-red: #d92027;
            --tile-border-color: #7D9D9C; /* √öj sz√≠n a jobb l√°that√≥s√°g√©rt */
        }

        body {
            background-color: var(--bg-dark-wood);
            background-image: linear-gradient(45deg, #3a2220 25%, transparent 25%), linear-gradient(-45deg, #3a2220 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #3a2220 75%), linear-gradient(-45deg, transparent 75%, #3a2220 75%);
            background-size: 20px 20px;
            font-family: 'Roboto Slab', serif;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            text-rendering: optimizeLegibility;
        }

        header {
            width: 100%;
            max-width: 1400px;
            padding-bottom: 20px;
            text-align: center;
        }
        
        #logo-container {
            width: clamp(300px, 40vw, 550px);
            margin: 0 auto;
        }

        #logo-svg {
            width: 100%;
            height: auto;
            filter: drop-shadow(3px 3px 4px #000);
        }

        #tv-container {
            width: 100%;
            max-width: 1400px;
            background-color: #5a3825;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.02) 10px, rgba(255,255,255,0.02) 20px),
                linear-gradient(to bottom, #5a3825, #4a2c2a);
            border: 15px solid var(--bg-dark-wood);
            border-radius: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 15px rgba(0,0,0,0.5);
            padding: 25px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        #screen {
            background-color: #1f2833;
            border-radius: 20px;
            box-shadow: inset 0 0 25px rgba(0,0,0,0.9);
            width: 100%;
            padding: clamp(10px, 2vw, 20px);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
            overflow: hidden;
        }

        #screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: repeating-linear-gradient(rgba(0, 0, 0, 0.2) 0, rgba(0, 0, 0, 0.2) 2px, transparent 2px, transparent 4px);
            pointer-events: none;
            z-index: 1;
        }
        
        #game-area {
            display: flex;
            gap: 20px;
            flex-grow: 1;
            position: relative;
            z-index: 2;
        }

        #puzzle-section {
            flex: 3;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            min-width: 0;
        }

        #puzzle-category {
            background-color: rgba(0,0,0,0.3);
            color: var(--font-color-light);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: clamp(1rem, 2vw, 1.5rem);
            border: 2px solid var(--gold-color);
            font-weight: 700;
            text-transform: uppercase;
            text-align: center;
        }

        #puzzle-board {
            display: flex;
            flex-direction: column;
            gap: 5px;
            width: 100%;
        }
        .puzzle-row {
            display: flex;
            justify-content: center;
            gap: 5px;
            width: 100%;
        }
        .puzzle-tile {
            width: clamp(35px, 5.5vw, 50px);
            height: clamp(45px, 7vw, 65px);
            perspective: 1000px;
        }
        
        .tile-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .puzzle-tile.revealed .tile-inner {
            transform: rotateY(180deg);
        }
        
        .tile-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 5px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }

        .tile-front {
            background-color: var(--tile-green);
            border: 2px solid var(--tile-border-color);
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5), 0 0 4px rgba(125, 157, 156, 0.4);
        }

        .tile-back {
            background-color: var(--font-color-light);
            color: var(--font-color-dark);
            font-weight: 700;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            transform: rotateY(180deg);
            text-shadow: 1px 1px 2px var(--gold-color);
        }
        .puzzle-tile.space {
             background-color: transparent;
             box-shadow: none;
             border: none;
        }
        .puzzle-tile.space .tile-inner {
             display: none;
        }


        #alphabet-panel {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            background-color: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 10px;
        }
        .alphabet-key {
            width: 35px;
            height: 35px;
            font-family: 'Roboto Slab', serif;
            font-weight: 700;
            font-size: 1rem;
            border: 1px solid var(--bg-dark-wood);
            border-bottom: 3px solid var(--bg-dark-wood);
            border-right: 3px solid var(--bg-dark-wood);
            border-radius: 5px;
            cursor: pointer;
            background-color: var(--font-color-light);
            color: var(--font-color-dark);
            box-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            transition: all 0.1s ease;
        }
        .alphabet-key.vowel {
            border-color: #2196f3;
            border-bottom-color: #1565c0;
            border-right-color: #1565c0;
        }
        .alphabet-key:hover:not(:disabled) {
            background-color: var(--gold-color);
        }
        .alphabet-key:active:not(:disabled) {
            transform: translateY(2px);
            border-bottom-width: 1px;
            border-right-width: 1px;
        }
        .alphabet-key:disabled {
            background-color: #616161;
            color: #bdbdbd;
            cursor: not-allowed;
            opacity: 0.7;
        }

        #game-controls-section {
            flex: 2;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            gap: 15px;
        }

        #wheel-wrapper {
            position: relative;
            width: clamp(280px, 40vh, 380px);
            aspect-ratio: 1 / 1;
        }

        #wheel-pointer {
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid var(--pointer-red);
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.5));
            border-radius: 3px;
            background: linear-gradient(to top, #c01a21, #f02e35);
            border-top: 30px solid #d92027;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            box-shadow: inset 0 2px 2px rgba(255,255,255,0.4);
        }
        
        #wheel {
            width: 100%;
            height: 100%;
            transition: transform 5s cubic-bezier(0.2, 0.8, 0.25, 1);
            filter: drop-shadow(3px 3px 5px rgba(0,0,0,0.5));
            border-radius: 50%;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.7);
        }

        #player-hud {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .hud-label {
            font-size: clamp(1rem, 2vw, 1.2rem);
            color: var(--font-color-light);
            font-weight: 700;
        }
        #score-display-container {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0,0,0,0.3);
            padding: 5px 20px;
            border-radius: 10px;
            margin-top: 5px;
            border: 2px solid var(--gold-color);
        }
        #score-display {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            color: var(--gold-color);
            font-weight: 700;
            text-shadow: 2px 2px 2px #000;
        }
        #round-display {
            font-size: 1rem;
            font-weight: 700;
            color: var(--font-color-light);
        }
        #hour-block-display {
            font-size: 0.9rem;
            color: #ccc;
            font-style: italic;
        }
        
        #host-message {
            background: rgba(0,0,0,0.2);
            border: 2px solid rgba(244, 233, 216, 0.5);
            color: white;
            padding: 10px;
            border-radius: 10px;
            min-height: 4em;
            text-align: center;
            font-size: clamp(0.9rem, 1.5vw, 1.1rem);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 400px;
        }
        #host-message strong { color: var(--gold-color); }

        #power-meter-container {
            width: 90%;
            max-width: 350px;
            height: 25px;
            background-color: var(--bg-dark-wood);
            border: 3px solid #f4e9d8;
            border-radius: 10px;
            overflow: hidden;
            padding: 3px;
        }
        #power-meter-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #ffeb3b, #f44336);
            border-radius: 5px;
        }
        #power-meter-bar.power-up {
            animation: power-up-anim 1.5s linear infinite;
        }
        @keyframes power-up-anim {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        #action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            width: 100%;
            flex-wrap: wrap;
        }
        .action-btn {
            padding: 12px 15px;
            font-family: 'Roboto Slab', serif;
            font-weight: 700;
            font-size: clamp(0.8rem, 2vw, 1rem);
            border-radius: 8px;
            border: 1px solid var(--bg-dark-wood);
            border-bottom: 4px solid var(--bg-dark-wood);
            box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
            cursor: pointer;
            transition: all 0.1s ease;
            text-transform: uppercase;
            flex-grow: 1;
            max-width: 150px;
        }
        .action-btn:hover:not(:disabled) { filter: brightness(1.1); }
        .action-btn:active:not(:disabled) { transform: translateY(3px); border-bottom-width: 1px; }
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        #spin-button { background-color: #4caf50; color: white; }
        #solve-button { background-color: var(--gold-color); color: var(--font-color-dark); }
        #new-game-button { background-color: #607d8b; color: white; margin-top: 10px; width: 100%; max-width: 310px;}
        
        #rules-container {
            background-color: var(--bg-wood);
            color: var(--font-color-light);
            padding: 20px;
            margin-top: 20px;
            width: 100%;
            max-width: 1400px;
            border-radius: 15px;
            border: 5px solid var(--bg-dark-wood);
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        #rules-container h2 { font-family: 'Shrikhand', cursive; color: var(--gold-color); text-align: center; margin-top: 0; text-shadow: 2px 2px 2px #000; }
        #rules-container ul { list-style-type: none; padding: 0; }
        #rules-container li { margin-bottom: 10px; padding-left: 25px; position: relative; }
        #rules-container li::before { content: 'üëâ'; color: var(--gold-color); position: absolute; left: 0; }
        #rules-container strong { color: var(--gold-color); font-weight: 700; }

        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: var(--bg-wood);
            padding: 30px;
            border-radius: 15px;
            border: 5px solid var(--bg-dark-wood);
            box-shadow: 0 5px 25px rgba(0,0,0,0.7);
            text-align: center;
            color: var(--font-color-light);
            width: 90%;
            max-width: 500px;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }
        .modal-content h3 {
            font-family: 'Shrikhand', cursive;
            color: var(--gold-color);
            margin-top: 0;
            font-size: 2rem;
            text-shadow: 2px 2px 2px #000;
        }
        .modal-content p {
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        #solve-input {
            width: 100%;
            padding: 10px;
            font-size: 1.2rem;
            border-radius: 5px;
            border: 2px solid var(--gold-color);
            background: var(--font-color-light);
            color: var(--font-color-dark);
            box-sizing: border-box;
            margin-bottom: 20px;
            text-transform: uppercase;
        }
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .modal-btn {
             padding: 12px 25px;
            font-family: 'Roboto Slab', serif;
            font-weight: 700;
            font-size: 1rem;
            border-radius: 8px;
            border: 1px solid var(--bg-dark-wood);
            border-bottom: 4px solid var(--bg-dark-wood);
            box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
            cursor: pointer;
            transition: all 0.1s ease;
            text-transform: uppercase;
        }
        #modal-confirm-btn { background-color: var(--gold-color); color: var(--font-color-dark); }
        #modal-cancel-btn { background-color: #607d8b; color: white; }

        /* === MOBILBAR√ÅT ST√çLUSOK === */
        @media (max-width: 900px) {
            body { 
                padding: 10px; 
            }
            #tv-container {
                padding: 15px;
                border-width: 10px;
                border-radius: 20px;
            }
            #screen {
                padding: 10px;
                border-radius: 10px;
                gap: 15px;
            }
            #game-area { 
                flex-direction: column; 
                align-items: center; 
                gap: 25px;
            }
            #puzzle-section {
                width: 100%;
            }
            #game-controls-section { 
                width: 100%; 
                max-width: 450px; 
            }
            #puzzle-board { 
                gap: 4px; 
            }
             .puzzle-row {
                gap: 4px;
            }
            .puzzle-tile { 
                width: clamp(28px, 6.5vw, 45px); 
                height: clamp(38px, 8.5vw, 55px); 
            }
            .tile-back { 
                font-size: clamp(1.2rem, 5vw, 2.2rem); 
            }
            .alphabet-key {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }
            #wheel-wrapper {
                width: clamp(260px, 75vw, 350px);
            }
            #host-message {
                min-height: 3em;
                font-size: clamp(0.85rem, 3vw, 1rem);
            }
            #rules-container {
                padding: 15px;
            }
             #rules-container h2 {
                font-size: 1.8rem;
            }
             #rules-container li {
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            #tv-container {
                padding: 5px;
                border-width: 8px;
            }
            #logo-container {
                 width: clamp(280px, 80vw, 320px);
            }
            .puzzle-row {
                gap: 3px;
            }
            .puzzle-tile {
                 width: clamp(24px, 6vw, 35px); 
                 height: clamp(32px, 8vw, 45px);
            }
            .alphabet-key {
                width: calc(10% - 5px); /* Dinamikusabb m√©retez√©s a legjobb sort√∂r√©s√©rt */
                height: 30px;
                font-size: 0.8rem;
                padding: 0;
            }
            #alphabet-panel {
                gap: 4px;
                padding: 8px;
            }
            .action-btn {
                padding: 10px 12px;
                font-size: 0.75rem;
            }
            #score-display-container {
                padding: 5px 10px;
                gap: 10px;
            }
            #score-display {
                font-size: clamp(1.5rem, 5vw, 2rem);
            }
            .hud-label, #round-display {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div id="logo-container">
            <svg id="logo-svg" viewBox="0 0 500 150">
                <defs>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Bevan&display=swap');
                    </style>
                    <linearGradient id="chromeGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#d0d0d0; stop-opacity:1" />
                        <stop offset="30%" style="stop-color:#f0f0f0; stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#a0a0a0; stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#707070; stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="goldGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#fff2a8; stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#f7b733; stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#e69a00; stop-opacity:1" />
                    </linearGradient>
                    <filter id="glow">
                        <feGaussianBlur stdDeviation="3.5" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>
                
                <text x="250" y="70" 
                      font-family="'Great Vibes', cursive" 
                      font-size="65" 
                      fill="url(#goldGradient)" 
                      text-anchor="middle"
                      stroke="#412A18"
                      stroke-width="1"
                      filter="url(#glow)">
                    B√©kebeli
                </text>
            
                <text x="250" y="120" 
                      font-family="'Bevan', cursive" 
                      font-size="42" 
                      fill="#1E1E1E" 
                      text-anchor="middle"
                      transform="translate(4, 4)"
                      opacity="0.6"
                      letter-spacing="2">
                    SZERENCSEKER√âK
                </text>

                <text x="250" y="120" 
                      font-family="'Bevan', cursive" 
                      font-size="42" 
                      fill="url(#chromeGradient)" 
                      stroke="#222" 
                      stroke-width="1.5"
                      text-anchor="middle"
                      letter-spacing="2">
                    SZERENCSEKER√âK
                </text>
                <text x="250" y="120" 
                      font-family="'Bevan', cursive" 
                      font-size="42" 
                      fill="white" 
                      opacity="0.4"
                      text-anchor="middle"
                      letter-spacing="2"
                      clip-path="polygon(0 0, 100% 0, 100% 45%, 0 45%)">
                    SZERENCSEKER√âK
                </text>
            </svg>
        </div>
    </header>
    <div id="tv-container">
        <div id="screen">
            <div id="game-area">
                <section id="puzzle-section">
                    <div id="puzzle-category"></div>
                    <div id="puzzle-board"></div>
                    <div id="alphabet-panel"></div>
                </section>
                <section id="game-controls-section">
                    <div id="player-hud">
                        <div class="hud-label">Teljes Nyerem√©ny</div>
                        <div id="score-display-container">
                            <div id="score-display">0 pont</div>
                            <div>
                                <div id="round-display"></div>
                                <div id="hour-block-display"></div>
                            </div>
                        </div>
                    </div>
                    <div id="wheel-wrapper">
                        <div id="wheel-pointer"></div>
                        <svg id="wheel" viewBox="0 0 100 100"></svg>
                    </div>
                    <div id="power-meter-container">
                        <div id="power-meter-bar"></div>
                    </div>
                    <div id="host-message">√údv√∂zl√∂m a st√∫di√≥ban! Kezd√©shez p√∂rgessen egyet!</div>
                    <div id="action-buttons">
                        <button id="spin-button" class="action-btn">P√∂rget√©s</button>
                        <button id="solve-button" class="action-btn">Megfejtem</button>
                        <button id="new-game-button" class="action-btn">√öj J√°t√©k</button>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <div id="rules-container">
        <h2>J√°t√©kszab√°lyzat</h2>
        <ul>
            <li><strong>A J√°t√©k C√©lja:</strong> A j√°t√©k <strong>√≥r√°nk√©nt meg√∫jul√≥</strong> feladv√°nysorozatokb√≥l √°ll. Minden √≥r√°ban 10 √∫j feladv√°ny v√°r! Fejtsd meg ≈ëket √©s gy≈±jts min√©l t√∂bb pontot!</li>
            <li><strong>P√∂rget√©s:</strong> Haszn√°ld a "P√∂rget√©s Er≈ëss√©ge" m√©r≈ët! Kattints a "P√∂rget√©s" gombra az ind√≠t√°shoz, majd m√©g egyszer a k√≠v√°nt er≈ëss√©gn√©l. A ker√©k √©rt√©kei minden fordul√≥ban magasabbak!</li>
            <li><strong>Bet≈±k V√°laszt√°sa:</strong> A feladv√°ny alatt tal√°lhat√≥ panelen v√°laszthatsz bet≈±ket.
                <ul>
                    <li><strong>M√°ssalhangz√≥:</strong> Sikeres p√∂rget√©s ut√°n kattints egy m√°ssalhangz√≥ra. Minden tal√°lat√©rt megkapod a kip√∂rgetett pontsz√°mot.</li>
                    <li><strong>Mag√°nhangz√≥:</strong> Ha te j√∂ssz, √©s van legal√°bb 250 pontod, b√°rmikor v√°s√°rolhatsz mag√°nhangz√≥t a k√©kkel jel√∂lt gombokkal.</li>
                </ul>
            </li>
            <li><strong>A Megfejt√©s:</strong> B√°rmikor, amikor te k√∂vetkezel, a "Megfejtem" gombbal megpr√≥b√°lhatod be√≠rni a megold√°st. Ha helyes, a fordul√≥ v√©get √©r, √©s a t√°bla felfedi a teljes megfejt√©st!</li>
            <li><strong>K√ºl√∂nleges Mez≈ëk:</strong>
                <ul>
                    <li><strong>CS≈êD:</strong> Ha ezt p√∂rgeted, a fordul√≥ban szerzett pontjaid null√°z√≥dnak!</li>
                    <li><strong>KIMARADSZ:</strong> Nem vesz√≠tesz pontot, de a k√∂r√∂d v√©get √©r.</li>
                    <li><strong>INGYEN MAG√ÅNHANGZ√ì:</strong> Kapsz egy ingyenes lehet≈ës√©get, amit b√°rmikor felhaszn√°lhatsz egy mag√°nhangz√≥ felfed√©s√©re.</li>
                    <li><strong>S√öG√ÅS:</strong> A m≈±sorvezet≈ë seg√≠t egy tippel a feladv√°nyhoz.</li>
                    <li><strong>EXPRESSZ:</strong> Kapsz 1000 pontot minden helyes m√°ssalhangz√≥√©rt, √©s addig tippelhetsz √∫jakat p√∂rget√©s n√©lk√ºl, am√≠g el nem hib√°zod.</li>
                    <li><strong>DUPLA VAGY SEMMI:</strong> Felford√≠tasz egy √©rm√©t, amivel megdupl√°zhatod vagy elvesz√≠theted a fordul√≥ban addig gy≈±jt√∂tt √∂sszes pontodat.</li>
                </ul>
            </li>
        </ul>
    </div>

    <div id="custom-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modal-title">Megfejt√©s</h3>
            <p id="modal-text">K√©rem a teljes megfejt√©st:</p>
            <input type="text" id="solve-input" autocomplete="off">
            <div class="modal-buttons">
                <button id="modal-confirm-btn" class="modal-btn">Rendben</button>
                <button id="modal-cancel-btn" class="modal-btn">M√©gse</button>
            </div>
        </div>
    </div>


    <audio id="spin-sound" src="placeholder_spin.mp3" preload="auto"></audio>
    <audio id="correct-sound" src="placeholder_correct.mp3" preload="auto"></audio>
    <audio id="bankrupt-sound" src="placeholder_bankrupt.mp3" preload="auto"></audio>
    <audio id="win-sound" src="placeholder_win.mp3" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // √öJ, B≈êV√çTETT FELADV√ÅNY ADATB√ÅZIS
            const allPuzzles = [
                // K√∂r 1
                { category: "K√∂zmond√°s", puzzle: "ADDIG J√ÅR A KORS√ì A K√öTRA", hint: "Vigy√°zz, mert egyszer p√≥rul j√°rsz..." },
                { category: "Film & Rendez≈ë", puzzle: "QUENTIN TARANTINO PULP FICTION", hint: "Egy kultikus film a 90-es √©vekb≈ël, nem line√°ris id≈ës√≠kkal." },
                { category: "√âtel & Ital", puzzle: "BRASS√ìI APR√ìPECSENYE", hint: "Hagyom√°nyos magyar √©tel, fokhagym√°s h√∫s √©s s√ºlt burgonya." },
                { category: "H√≠res Ember", puzzle: "PUSK√ÅS FERENC", hint: "Az Aranycsapat legend√°s kapit√°nya, akit a vil√°g minden t√°j√°n ismernek." },
                { category: "F√∂ldrajz", puzzle: "A PISAI FERDE TORONY", hint: "Olaszorsz√°g egyik legh√≠resebb, √°mde instabil √©p√≠tm√©nye." },
                { category: "Sl√°ger", puzzle: "NEOTON FAM√çLIA DON QUIJOTE", hint: "Spanyol h√≥d√≠t√≥r√≥l sz√≥l√≥, f√ºlbem√°sz√≥ magyar diszk√≥sl√°ger." },
                { category: "Retr√≥ T√°rgy", puzzle: "TRAPPER FARMER", hint: "Mindenki ezt akarta hordani a 80-as √©vekben." },
                { category: "Retr√≥ Rekl√°m", puzzle: "CSOKI CHIPS K√ìLA", hint: "A Sk√°la K√≥p√© legend√°s mond√°sa." },
                { category: "TV M≈±sor", puzzle: "DALLAS A TELEV√çZI√ìBAN", hint: "Ki l≈ëtte le Jockey-t? Egy eg√©sz orsz√°g ezt tal√°lgatta." },
                { category: "Kifejez√©s", puzzle: "LEESETT A H√öSZFILL√âRES", hint: "V√©gre meg√©rtette, mir≈ël van sz√≥." },
                // K√∂r 2
                { category: "M√°rka", puzzle: "FABULON A B≈êR ≈êRE", hint: "Pataki √Ågi is ezt haszn√°lta a napon." },
                { category: "√âdess√©g", puzzle: "T√âLI FAGYI", hint: "Csak a nev√©ben volt hideg, val√≥j√°ban egy √©des kr√©m volt t√∂lcs√©rben." },
                { category: "J√°rm≈±", puzzle: "TRABANT KULCS", hint: "A rem√©ny szimb√≥luma, ami egy papundekli aut√≥t ind√≠tott." },
                { category: "Sorozat", puzzle: "SZOMSZ√âDOK TELENOVELLA", hint: "Taki b√°csi, Lenke n√©ni √©s a t√∂bbiek a Lantos utc√°b√≥l." },
                { category: "Ital", puzzle: "M√ÅRKA MEGGY √úD√çT≈ê", hint: "A magyar √ºd√≠t≈ë, ami bubor√©kos √©s nagyon piros." },
                { category: "Sportol√≥", puzzle: "KOV√ÅCS KOKO ISTV√ÅN", hint: "Olimpiai bajnok bokszol√≥nk, a n√©p kedvence." },
                { category: "Film", puzzle: "CSAPAT√ÅS A SZTR√ÅD√ÅN", hint: "Burt Reynolds √©s a fekete Pontiac Firebird." },
                { category: "Zene", puzzle: "MODERN TALKING", hint: "Dieter Bohlen √©s Thomas Anders du√≥ja, a diszk√≥k kir√°lyai." },
                { category: "Meseh≈ës", puzzle: "A NAGY HO HO HO HORG√ÅSZ", hint: "A f≈ë-f≈ë-f≈ë kukaccal horg√°szott a t√©len." },
                { category: "K√∂zleked√©s", puzzle: "BKV ELLEN≈êR", hint: "Soha nem volt j√≥, ha megjelent a buszon." },
                // K√∂r 3
                { category: "Szlogen", puzzle: "VEGYENEK LEG√ìT", hint: "Egy j√°t√©k, ami fant√°zi√°t ad a gyerekeknek." },
                { category: "Helysz√≠n", puzzle: "R√ìMAI PARTI L√ÅNGOS", hint: "Sajtos-tejf√∂l√∂s finoms√°g a Duna mellett." },
                { category: "Technika", puzzle: "VIDEOTON SZ√çNES TELEV√çZI√ì", hint: "A technika csod√°ja, ami m√°r nem volt fekete-feh√©r." },
                { category: "Kifejez√©s", puzzle: "EZ TUTKER√ÅJ", hint: "Amikor valami nagyon men≈ë √©s szuper." },
                { category: "Politika", puzzle: "RENDSZERV√ÅLT√ÅS", hint: "A 80-as √©vek v√©g√©nek nagy esem√©nye Magyarorsz√°gon." },
                { category: "J√°t√©k", puzzle: "MONCSICSI MAJOM", hint: "Egy majomfigura, aminek az ujj√°t a sz√°j√°ba lehetett dugni." },
                { category: "√âp√ºlet", puzzle: "SK√ÅLA METR√ì √ÅRUH√ÅZ", hint: "Ahol a Sk√°la K√≥p√© is dolgozott, a Nyugatin√°l." },
                { category: "Tud√≥s", puzzle: "RUBIK ERN≈ê", hint: "A vil√°gh√≠r≈± b≈±v√∂s kocka feltal√°l√≥ja." },
                { category: "Sorozat", puzzle: "LINDA A REND≈êRL√ÅNY", hint: "Veszpr√©mi Andrea, aki kung-fuval oldotta meg az √ºgyeket." },
                { category: "Retr√≥ Szok√°s", puzzle: "KAZETTA M√ÅSOL√ÅS TOLLAL", hint: "Amikor a magn√≥ bekapta a szalagot, ez volt a megold√°s." }
            ];
            let hourlyPuzzleIndices = [];

            const wheelSegmentsR1 = [
                { label: '300', value: 300, color: '#4caf50' }, { label: 'CS≈êD', value: 'bankrupt', color: '#212121' },
                { label: '500', value: 500, color: '#f44336' }, { label: 'S√öG√ÅS', value: 'hint', color: '#9c27b0' },
                { label: 'KIMARADSZ', value: 'lose_turn', color: '#607d8b' }, { label: '400', value: 400, color: '#ff9800' },
                { label: '600', value: 600, color: '#3f51b5' }, { label: 'CS≈êD', value: 'bankrupt', color: '#212121' },
                { label: '700', value: 700, color: '#e91e63' }, { label: '350', value: 350, color: '#00bcd4' },
                { label: '550', value: 550, color: '#8bc34a' }, { label: '1000', value: 1000, color: '#ffc107' }
            ];
            const wheelSegmentsR2 = [
                { label: '600', value: 600, color: '#4caf50' }, { label: 'CS≈êD', value: 'bankrupt', color: '#212121' },
                { label: '800', value: 800, color: '#f44336' }, { label: 'INGYEN MGH', value: 'free_vowel', color: '#9c27b0' },
                { label: 'KIMARADSZ', value: 'lose_turn', color: '#607d8b' }, { label: '700', value: 700, color: '#ff9800' },
                { label: '+5000', value: 5000, color: '#3f51b5' }, { label: 'CS≈êD', value: 'bankrupt', color: '#212121' },
                { label: '900', value: 900, color: '#e91e63' }, { label: '500', value: 500, color: '#00bcd4' },
                { label: '1200', value: 1200, color: '#8bc34a' }, { label: '2000', value: 2000, color: '#ffc107' }
            ];
            const wheelSegmentsR3 = [
                { label: '1000', value: 1000, color: '#4caf50' }, { label: 'CS≈êD', value: 'bankrupt', color: '#212121' },
                { label: '1500', value: 1500, color: '#f44336' }, { label: 'DUPLA/SEMMI', value: 'double_or_nothing', color: '#9c27b0' },
                { label: 'KIMARADSZ', value: 'lose_turn', color: '#607d8b' }, { label: '2000', value: 2000, color: '#ff9800' },
                { label: 'EXPRESSZ', value: 'express', color: '#d92027' }, { label: 'CS≈êD', value: 'bankrupt', color: '#212121' },
                { label: '1200', value: 1200, color: '#e91e63' }, { label: '750', value: 750, color: '#00bcd4' },
                { label: '3000', value: 3000, color: '#8bc34a' }, { label: '5000', value: 5000, color: '#cddc39' }
            ];
            const wheelSegmentSets = [wheelSegmentsR1, wheelSegmentsR2, wheelSegmentsR3];
            
            const PUZZLES_PER_HOUR = 10;
            const VOWELS = "A√ÅE√âI√çO√ì√ñ≈êU√ö√ú≈∞";
            const FULL_ALPHABET = "A√ÅBCDE√âFGHI√çJKLMNO√ì√ñ≈êPQRSTU√ö√ú≈∞VXYZ";
            const VOWEL_COST = 250;

            const HOST_MESSAGES = {
                start_game: ["H√∂lgyeim √©s Uraim, kezd≈ëdj√∂n a j√°t√©k! L√°ssuk az els≈ë feladv√°nyt!", "A st√∫di√≥ f√©nyei kigy√∫ltak, a ker√©k k√©szen √°ll! Sok szerencs√©t!", "A hajsz√°r√≠t√≥k z√∫gnak, a tup√≠rok tartanak, a Szerencseker√©k pedig forogni k√©sz√ºl! Induljon a menet!", "Szervusz, kedves j√°t√©kos! A mai f≈ënyerem√©ny egy Trabant tele... rem√©nnyel! V√°gjunk is bele!", "Bekapcsoltuk a Videoton t√©v√©t, be√°ll√≠tottuk az ad√°st, kezd≈ëdj√∂n a szerencsevad√°szat!", "A st√∫di√≥ban Fabulon-illat √©s izgalom terjeng. V√°gjunk is bele!"],
                start_round: ["J√∂het a(z) <strong>{round}. fordul√≥</strong>! A t√©tek emelkednek!", "√öj fordul√≥, √∫j rem√©nyek! L√°ssuk a k√∂vetkez≈ë feladv√°nyt!", "√öj k√∂r, √∫j feladv√°ny! A pontsz√°mok, mint a doll√°r-forint √°rfolyam, az egekben!", "L√°ssuk a k√∂vetkez≈ë felvon√°st! Rem√©lem, hozott mag√°val egy kabal√°t!", "√öjabb k√∂r, mint a bakelitlemezen. L√°ssuk, mit rejt a bar√°zda!", "A t√©t n≈ë, a fesz√ºlts√©g fokoz√≥dik! J√∂het a <strong>{round}. fordul√≥</strong>!"],
                power_up: ["Induljon a p√∂rget√©s! √Åll√≠tsa be az er≈ëss√©get!", "Na l√°ssuk, mekkor√°t lend√≠t rajta!", "Mutassa meg, mekkora er≈ë lakozik a csukl√≥j√°ban!", "Lend√ºletet k√©rek! P√∂rgess√ºnk, mintha nem lenne holnap!", "Adjon neki kaka√≥t, ahogy a k√∂nyvben meg van √≠rva!", "Lend√≠tse meg, mint a Linda a rosszfi√∫kat!"],
                spinning: ["A ker√©k forog, a kassza cs√∂r√∂g!", "L√°ssuk, hol √°ll meg a szerencse!", "Nagy p√∂rget√©s, nagy rem√©nyek!", "Forog a ker√©k, remeg a st√∫di√≥! Hol √°ll meg a csoda?", "P√∂r√∂g, mint a Sk√°la-k√≥p√© rekl√°mja!", "A mutat√≥ keresi a hely√©t, mint turista a Balatonon.", "Forog a ker√©k, sz√≥l a Zolt√°n Erika!"],
                spin_result: ["A p√∂rget√©s √©rt√©ke <strong>{value} pont</strong>. Most j√∂het egy m√°ssalhangz√≥!", "<strong>{value} pont</strong> a t√©t! Melyik bet≈±re gondol?", "A ker√©k <strong>{value}</strong> forintot... azaz pontot mutat! Mondjon egy m√°ssalhangz√≥t, de ne a 'Dz'-t!", "Ez egy sz√©p summa: <strong>{value}</strong> pont! Egy bet≈±t k√©rek, de gyorsan, miel≈ëtt a rendez≈ë k√°v√©sz√ºnetet rendel el!", "Remek, <strong>{value}</strong> pont! Ez√©rt m√°r egy Trapper farmert is adn√°nak! Melyik bet≈± lesz az?", "Ez <strong>{value}</strong> pont! Ebb≈ël m√°r kij√∂n egy j√≥ l√°ngos a R√≥mai-parton! Halljuk a tippet!"],
                bankrupt: ["Jaj, ne! <strong>CS≈êD!</strong> A fordul√≥s kassza most s√≠rva fakad, a pontok el√∫sznak!", "Ez a legrosszabb mez≈ë! A cs≈ëd mindent vitt ebben a k√∂rben!", "Le√©gett a biztos√≠t√©k! A <strong>CS≈êD</strong> mindent vitt, de a j√≥kedv√ºnket nem viheti!", "√ì, a fr√°sz! Ez a fekete mez≈ë! A pontok elsz√°lltak, mint a novemberi k√∂d!", "Jaj, a nagy fekete semmi! A pontok mentek a levesbe, mint a nokedli!", "Mint a rosszul felvett kazetta, a fordul√≥s pontoknak annyi! Sajn√°lom!"],
                lose_turn: ["<strong>KIMARADSZ!</strong> Egy pillanatnyi pihen≈ë, de a k√∂vetkez≈ë k√∂rben √∫jra pr√≥b√°lkozhat!", "Most sajnos √°t kell adnia a lehet≈ës√©get.", "Hopp√°, egy kis pihen≈ë! Most a t√∂bbiek j√∂nnek, de ne cs√ºggedjen!", "A szerencse most m√°ssal van. Egy k√∂r √©s √∫jra √∂nn√©l a labda!", "Most j√∂n egy rekl√°mblokk, am√≠g √∂n pihen! Kitart√°s!", "√Åtadja a staf√©t√°t, mint a Vitray a H√≠rad√≥ban! Hamarosan visszat√©r√ºnk!"],
                hint: ["L√°tom, elakadt. S√∫gok egy kicsit: <strong>{hint}</strong>. Most √∫jra p√∂rgethet!", "Egy kis seg√≠ts√©g a h√°zt√≥l: <strong>{hint}</strong>. Folytassa!"],
                free_vowel: ["Fantasztikus! Nyert egy <strong>INGYEN MAG√ÅNHANGZ√ìT</strong>! Ezt k√©s≈ëbb is felhaszn√°lhatja.", "A ker√©k kegyes volt, egy ingyen mag√°nhangz√≥ a jutalma!", "Ez aj√°nd√©k, fogadja szeretettel! Egy <strong>INGYEN MAG√ÅNHANGZ√ì</strong>!"],
                bonus_points: ["<strong>+{value} PONT!</strong> Ez egy sz√©p kis b√≥nusz! Gratul√°lok!", "Azonnali <strong>{value} pont</strong>! Ezzel nagyot l√©pett el≈ëre!", "Hopp√°! A kassza <strong>{value}</strong> ponttal lett nehezebb! Csak √≠gy tov√°bb!"],
                express: ["<strong>EXPRESSZ!</strong> Fantasztikus! Minden helyes m√°ssalhangz√≥ 1000 pont, √©s addig j√∂het, am√≠g nem hib√°zik!", "Felsz√°llt az Expresszre! Most nincs meg√°ll√°s!", "Vigy√°zat, az ajt√≥k z√°r√≥dnak! Az <strong>EXPRESSZ</strong> elindult! Sok sikert!"],
                double_or_nothing_prompt: ["<strong>DUPLA VAGY SEMMI!</strong> Kock√°ztatja a k√∂rben szerzett <strong>{points} pontot</strong>?"],
                double_win: ["<strong>DUPLA!</strong> Bej√∂tt a kock√°zat, megdupl√°zta a k√∂r√∂s pontjait!", "B√°tor d√∂nt√©s volt, √©s meg√©rte! Aki mer, az nyer!"],
                double_lose: ["<strong>SEMMI!</strong> A szerencse most elp√°rtolt, a k√∂r√∂s pontok el√∫sztak.", "Aki mer, az n√©ha vesz√≠t. Sajn√°lom, ez most nem j√∂tt be."],
                correct_consonant: ["Zseni√°lis! Van <strong>{count}</strong> darab, ez <strong>{earnings} pontot</strong> √©r! Ism√©t √∂n j√∂n!", "Eltal√°lta! <strong>{count}</strong> bet≈±, <strong>{earnings} pont</strong>! Folytassa!", "Ott van, ni! <strong>{count}</strong> darab, mint a j√≥ csoki a KGST-piacon! Ez <strong>{earnings} pontot</strong> √©r!", "Bing√≥! Eltal√°lta! <strong>{count}</strong> darab, ami√©rt <strong>{earnings}</strong> pont a jutalma!", "Ez 'tutker√°j'! <strong>{count}</strong> darab, ami√©rt <strong>{earnings}</strong> pont a jutalma! √ñn egy √©szkomb√°jn!", "Telital√°lat! <strong>{count}</strong> bet≈±, <strong>{earnings}</strong> pont! Frank√≥!"],
                correct_vowel: ["Igen, van <strong>{count}</strong> darab! A k√∂r folytat√≥dik.", "J√≥l gondolta, a t√°bl√°n van <strong>{count}</strong> ilyen bet≈±!", "A mag√°nhangz√≥ a hely√©n! A megfejt√©s m√°r dereng, mint egy Pann√≥nia l√°mp√°ja!", "T√∂k√©letes! Van <strong>{count}</strong> ilyen bet≈±nk, a t√°bla egyre bar√°ts√°gosabb!", "Megvan! A mag√°nhangz√≥ a hely√©n, mint V√°g√°si Feri a sz√°m√≠t√≥g√©p el≈ëtt!", "Term√©szetesen van! <strong>{count}</strong> darab, m√°r majdnem kint van a v√≠zb≈ël!"],
                wrong_letter: ["Sajn√°lom, de ez a bet≈± nincs a feladv√°nyban.", "Ez most nem j√∂tt be. A k√∂vetkez≈ë p√∂rget√©sig v√°rnia kell.", "Sajnos ez a bet≈± most szabads√°gon van.", "A bet≈±fal nemet intett. Sebaj, a k√∂vetkez≈ë k√∂rben jav√≠that!", "Ez a bet≈± most a pressz√≥ban k√°v√©zik, nincs itt.", "Sajnos ez a tipp most mell√©ment, mint egy rossz vicc."],
                solve_success: ["<strong>MEGFEJT√âS!</strong> Gratul√°lok, ez a helyes megold√°s!", "Kiv√°l√≥! Pontosan ez volt a feladv√°ny!", "Ez az! Megvan a megfejt√©s! √ñn egy igazi fejt√∂r≈ë-fenom√©n!", "√âs a helyes megfejt√©s... PONTOSAN EZ! Hatalmas tapsot!", "Le a kalappal! Ez a helyes megfejt√©s!", "Megvan! √ñn egy agytr√∂szt! A megfejt√©s helyes, a st√∫di√≥ tombol!"],
                game_win: ["<strong>V√âGE AZ AD√ÅSNAK!</strong> Hatalmas gratul√°ci√≥! A v√©gs≈ë nyerem√©nye <strong>{score} pont</strong>! K√∂sz√∂nj√ºk a j√°t√©kot!", "√âs megvagyunk! Egy fantasztikus j√°t√©k v√©g√©n <strong>{score} ponttal</strong> lett gazdagabb! Gratul√°lunk!", "Az ad√°sblokk v√©get √©rt, de a dics≈ës√©g √∂r√∂k! <strong>{score} pont</strong> a v√©geredm√©ny, gratul√°lunk, √ñn egy bajnok!", "Le a kalappal! A mai ad√°st <strong>{score} ponttal</strong> nyerte! Zsebelje be a virtu√°lis bab√©rokat!", "A gy≈ëztes mindent visz! <strong>{score} pont</strong>, √©s √∂r√∂k dics≈ës√©g a jutalma! Viszontl√°t√°sra!"],
                hour_end: ["<strong>Elfogyott a rejtv√©ny!</strong> Gratul√°lok, megoldotta a mostani ad√°s √∂sszes feladv√°ny√°t! A st√∫di√≥ most egy √≥r√°ra sz√ºnetet tart. T√©rjen vissza a k√∂vetkez≈ë √≥r√°ban egy teljesen √∫j adag rejtv√©ny√©rt! Addig is, hallgasson egy kis Neotont!", "Minden rejtv√©nyt megoldott, le a kalappal! <strong>A k√∂vetkez≈ë ad√°s egy √≥ra m√∫lva kezd≈ëdik</strong> √∫j feladv√°nyokkal! Addig egy kis sz√ºnet, igyon egy M√°rka meggyet!"],
                turn_end: ["√öjra √∂nn√©l a lehet≈ës√©g! P√∂rgessen, vagy vegyen mag√°nhangz√≥t!", "L√°ssuk a k√∂vetkez≈ë l√©p√©st! P√∂rget vagy v√°s√°rol?", "Ism√©t √∂n√© a terep! Mutassa meg, mit tud!", "√ñnn√©l a labda! P√∂rget√©s vagy v√°s√°rl√°s?"]
            };

            let gameState;
            let currentModal = { resolve: null, reject: null };

            const wheel = document.getElementById('wheel');
            const spinButton = document.getElementById('spin-button');
            const solveButton = document.getElementById('solve-button');
            const newGameButton = document.getElementById('new-game-button');
            const puzzleBoard = document.getElementById('puzzle-board');
            const puzzleCategory = document.getElementById('puzzle-category');
            const scoreDisplay = document.getElementById('score-display');
            const roundDisplay = document.getElementById('round-display');
            const hourBlockDisplay = document.getElementById('hour-block-display');
            const hostMessage = document.getElementById('host-message');
            const alphabetPanel = document.getElementById('alphabet-panel');
            const powerMeterBar = document.getElementById('power-meter-bar');
            
            const modalOverlay = document.getElementById('custom-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalText = document.getElementById('modal-text');
            const solveInput = document.getElementById('solve-input');
            const modalConfirmBtn = document.getElementById('modal-confirm-btn');
            const modalCancelBtn = document.getElementById('modal-cancel-btn');

            // --- FUNKCI√ìK AZ √ìR√ÅNK√âNTI FELADV√ÅNYOKHOZ ---
            function seededRandom(seed) {
                let state = seed;
                return function() {
                    state = (state * 9301 + 49297) % 233280;
                    return state / 233280;
                };
            }

            function getHourlyPuzzles() {
                const hourId = Math.floor(Date.now() / (1000 * 60 * 60));
                const random = seededRandom(hourId); 
                
                const allIndices = Array.from(allPuzzles.keys());
                
                for (let i = allIndices.length - 1; i > 0; i--) {
                    const j = Math.floor(random() * (i + 1));
                    [allIndices[i], allIndices[j]] = [allIndices[j], allIndices[i]];
                }
                
                return {
                    indices: allIndices.slice(0, PUZZLES_PER_HOUR),
                    hourId: hourId 
                };
            }
            
            // --------------------------------------------------

            function playSound(id) {
                const sound = document.getElementById(id);
                if (sound) {
                    sound.currentTime = 0;
                    sound.play().catch(e => console.log("Hiba a hanglej√°tsz√°skor:", e));
                }
            }
            
            function getRandomMessage(category, replacements = {}) {
                const messages = HOST_MESSAGES[category];
                let message = messages[Math.floor(Math.random() * messages.length)];
                for (const key in replacements) {
                    message = message.replace(new RegExp(`{${key}}`, 'g'), replacements[key]);
                }
                return message;
            }

            function resetGameState(isNewGame = false) {
                const oldState = gameState;
                gameState = {
                    playerScore: isNewGame ? 0 : oldState.playerScore,
                    roundStartScore: isNewGame ? 0 : oldState.playerScore,
                    currentRound: isNewGame ? 1 : oldState.currentRound + 1,
                    totalRounds: isNewGame ? 0 : oldState.totalRounds,
                    puzzleHourId: isNewGame ? null : oldState.puzzleHourId,
                    currentSpinValue: null,
                    isSpinning: false,
                    isPoweringUp: false,
                    awaitingConsonant: false,
                    isExpressTurn: false,
                    freeVowels: isNewGame ? 0 : (oldState ? oldState.freeVowels : 0),
                    guessedLetters: []
                };
            }

            function setupPuzzleBoard() {
                const puzzleData = allPuzzles[hourlyPuzzleIndices[gameState.currentRound - 1]];
                puzzleCategory.textContent = puzzleData.category;
                puzzleBoard.innerHTML = '';
                const words = puzzleData.puzzle.toUpperCase().split(' ');
                
                // MOBILBAR√ÅT T√ñRDEL√âS: 12 KARAKTERES LIMIET SORONK√âNT
                const rows = [];
                let currentRow = [];
                let currentLength = 0;
                const maxRowLength = window.innerWidth < 480 ? 10 : 14;
                
                words.forEach(word => {
                    if (currentLength + word.length > maxRowLength && currentRow.length > 0) {
                        rows.push(currentRow);
                        currentRow = [];
                        currentLength = 0;
                    }
                    currentRow.push(word);
                    currentLength += word.length + 1;
                });
                rows.push(currentRow);

                rows.forEach(wordArray => {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'puzzle-row';
                    wordArray.forEach((word, wordIndex) => {
                        word.split('').forEach(char => {
                            const tile = document.createElement('div');
                            tile.className = 'puzzle-tile';
                            tile.innerHTML = `<div class="tile-inner"><div class="tile-face tile-front"></div><div class="tile-face tile-back">${char}</div></div>`;
                            tile.dataset.letter = char;
                            rowDiv.appendChild(tile);
                        });
                        
                        if(wordIndex < wordArray.length - 1) {
                             const spaceTile = document.createElement('div');
                             spaceTile.className = 'puzzle-tile space';
                             rowDiv.appendChild(spaceTile);
                        }
                    });
                    puzzleBoard.appendChild(rowDiv);
                });
            }

            function createAlphabetPanel() {
                alphabetPanel.innerHTML = '';
                FULL_ALPHABET.split('').forEach(letter => {
                    const key = document.createElement('button');
                    key.className = 'alphabet-key';
                    key.textContent = letter;
                    key.dataset.letter = letter;
                    if (VOWELS.includes(letter)) key.classList.add('vowel');
                    key.addEventListener('click', () => handleLetterGuess(letter));
                    alphabetPanel.appendChild(key);
                });
            }
            
            function updateAlphabetPanel() {
                document.querySelectorAll('.alphabet-key').forEach(key => {
                    const letter = key.dataset.letter;
                    const isVowel = VOWELS.includes(letter);
                    
                    key.disabled = gameState.guessedLetters.includes(letter) || gameState.isSpinning;

                    if (!isVowel) {
                        key.disabled = key.disabled || (!gameState.awaitingConsonant && !gameState.isExpressTurn);
                    } else {
                        key.disabled = key.disabled || gameState.awaitingConsonant || (gameState.playerScore < VOWEL_COST && gameState.freeVowels === 0);
                    }
                });
            }

            function polarToCartesian(cx, cy, r, angle) {
                const rad = (angle - 90) * Math.PI / 180.0;
                return { x: cx + (r * Math.cos(rad)), y: cy + (r * Math.sin(rad)) };
            }
            
            function drawWheel(round) {
                const wheelSetIndex = Math.min(round - 1, wheelSegmentSets.length - 1);
                wheel.innerHTML = '';
                const segments = wheelSegmentSets[wheelSetIndex];
                const numSegments = segments.length;
                const angleStep = 360 / numSegments;
                const radius = 50;
                const center = 50;
                
                const bgCircle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                bgCircle.setAttribute("cx", center);
                bgCircle.setAttribute("cy", center);
                bgCircle.setAttribute("r", radius);
                bgCircle.setAttribute("fill", "#333");
                wheel.appendChild(bgCircle);

                for (let i = 0; i < numSegments; i++) {
                    const segment = segments[i];
                    const startAngle = i * angleStep;
                    const endAngle = (i + 1) * angleStep;
                    const start = polarToCartesian(center, center, radius, endAngle);
                    const end = polarToCartesian(center, center, radius, startAngle);
                    const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
                    
                    const d = `M ${start.x} ${start.y} A ${radius} ${radius} 0 ${largeArcFlag} 0 ${end.x} ${end.y} L ${center} ${center} Z`;
                    
                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    path.setAttribute("d", d);
                    path.setAttribute("fill", segment.color);
                    path.setAttribute("stroke", "rgba(0,0,0,0.4)");
                    path.setAttribute("stroke-width", "0.5");
                    wheel.appendChild(path);

                    const textAngle = startAngle + angleStep / 2;
                    const textPos = polarToCartesian(center, center, radius * 0.7, textAngle);
                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute("x", textPos.x);
                    text.setAttribute("y", textPos.y);
                    text.setAttribute("text-anchor", "middle");
                    text.setAttribute("dominant-baseline", "middle");
                    text.setAttribute("font-weight", "bold");
                    text.setAttribute("font-size", "4.8px");
                    text.setAttribute("fill", typeof segment.value === 'number' && segment.value < 5000 ? '#111' : 'white');
                    text.setAttribute("transform", `rotate(${textAngle + 90} ${textPos.x} ${textPos.y})`);
                    
                    const words = segment.label.split(' ');
                    if (words.length > 1) {
                         words.forEach((word, index) => {
                            const tspan = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                            tspan.setAttribute("x", textPos.x);
                            tspan.setAttribute("dy", `${index === 0 ? -0.5 * (words.length - 1) * 4.8 : 4.8}`);
                            tspan.textContent = word;
                            text.appendChild(tspan);
                        });
                    } else {
                        text.textContent = segment.label;
                    }
                    wheel.appendChild(text);

                    const pegPos = polarToCartesian(center, center, radius -1, startAngle);
                    const peg = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    peg.setAttribute("cx", pegPos.x);
                    peg.setAttribute("cy", pegPos.y);
                    peg.setAttribute("r", 1.2);
                    peg.setAttribute("fill", "silver");
                    peg.setAttribute("stroke", "black");
                    peg.setAttribute("stroke-width", "0.3");
                    wheel.appendChild(peg);
                }

                const hub = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                hub.setAttribute("cx", center);
                hub.setAttribute("cy", center);
                hub.setAttribute("r", "8");
                hub.setAttribute("fill", "#666");
                hub.setAttribute("stroke", "#333");
                hub.setAttribute("stroke-width", "1");
                wheel.appendChild(hub);
                const hubShine = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                hubShine.setAttribute("cx", center);
                hubShine.setAttribute("cy", center);
                hubShine.setAttribute("r", "6");
                hubShine.setAttribute("fill", "#aaa");
                wheel.appendChild(hubShine);
            }
            
            function updateUI() {
                scoreDisplay.textContent = `${gameState.playerScore} pont`;
                if(gameState.totalRounds > 0){
                    roundDisplay.textContent = `Fordul√≥: ${gameState.currentRound}/${gameState.totalRounds}`;
                    const date = new Date(gameState.puzzleHourId * 60 * 60 * 1000);
                    hourBlockDisplay.textContent = `Ad√°s: ${date.getHours()}:00 √≥rai blokk`;
                } else {
                    roundDisplay.textContent = '';
                    hourBlockDisplay.textContent = 'V√°rakoz√°s az ad√°sra...';
                }
                solveButton.disabled = gameState.isSpinning || gameState.awaitingConsonant;
                spinButton.disabled = gameState.isSpinning || gameState.awaitingConsonant || gameState.isExpressTurn;
                updateAlphabetPanel();
            }

            function updateHostMessage(message, isImportant = false) {
                hostMessage.innerHTML = message;
                hostMessage.style.borderColor = isImportant ? 'var(--gold-color)' : 'rgba(244, 233, 216, 0.5)';
            }

            function showModal({title, text, showInput = false, confirmText = 'Rendben', cancelText = 'M√©gse', showCancel = true}) {
                return new Promise((resolve, reject) => {
                    modalTitle.textContent = title;
                    modalText.innerHTML = text;
                    solveInput.style.display = showInput ? 'block' : 'none';
                    if (showInput) solveInput.focus();
                    solveInput.value = '';
                    modalConfirmBtn.textContent = confirmText;
                    modalCancelBtn.textContent = cancelText;
                    modalCancelBtn.style.display = showCancel ? 'inline-flex' : 'none';
                    modalOverlay.classList.add('visible');
                    currentModal.resolve = resolve;
                    currentModal.reject = reject;
                });
            }

            function closeModal(value) {
                modalOverlay.classList.remove('visible');
                if (value !== null && currentModal.resolve) {
                    currentModal.resolve(value);
                } else if (currentModal.reject) {
                    currentModal.reject();
                }
                currentModal = { resolve: null, reject: null };
            }

            modalConfirmBtn.addEventListener('click', () => {
                const value = solveInput.style.display === 'block' ? solveInput.value : true;
                closeModal(value);
            });
            modalCancelBtn.addEventListener('click', () => closeModal(null));
            
            function togglePowerMeter() {
                if (gameState.isSpinning || gameState.awaitingConsonant) return;
                if (!gameState.isPoweringUp) {
                    gameState.isPoweringUp = true;
                    powerMeterBar.classList.add('power-up');
                    updateHostMessage(getRandomMessage('power_up'));
                    spinButton.textContent = "MEG√ÅLL√çT";
                } else {
                    gameState.isPoweringUp = false;
                    powerMeterBar.classList.remove('power-up');
                    const power = powerMeterBar.offsetWidth / powerMeterBar.parentElement.offsetWidth;
                    powerMeterBar.style.width = `${power * 100}%`;
                    spinButton.textContent = "P√ñRGET√âS";
                    spinWheel(power);
                }
            }

            function spinWheel(power) {
                if (gameState.isSpinning) return;
                gameState.isSpinning = true;
                gameState.currentSpinValue = null;
                updateUI();
                updateHostMessage(getRandomMessage('spinning'));
                playSound('spin-sound');
                const baseRotations = 3;
                const powerRotation = power * 4;
                const randomExtraRotation = Math.random();
                const totalRotation = (baseRotations + powerRotation + randomExtraRotation) * 360;
                const currentRotation = parseFloat(wheel.dataset.rotation || 0);
                const newRotation = currentRotation + totalRotation;
                wheel.style.transform = `rotate(${newRotation}deg)`;
                wheel.dataset.rotation = newRotation;
                setTimeout(() => {
                    gameState.isSpinning = false;
                    const wheelSetIndex = Math.min(gameState.currentRound - 1, wheelSegmentSets.length - 1);
                    const segments = wheelSegmentSets[wheelSetIndex];
                    const finalAngle = newRotation % 360;
                    const segmentAngle = 360 / segments.length;
                    const segmentIndex = Math.floor((360 - finalAngle % 360) / segmentAngle);
                    const result = segments[segmentIndex];
                    handleSpinResult(result);
                    powerMeterBar.style.width = '0%';
                }, 5000);
            }

            function handleSpinResult(result) {
                gameState.awaitingConsonant = false;
                switch(result.value) {
                    case 'bankrupt':
                        playSound('bankrupt-sound');
                        updateHostMessage(getRandomMessage('bankrupt'), true);
                        gameState.playerScore = gameState.roundStartScore;
                        endTurn();
                        break;
                    case 'lose_turn':
                        updateHostMessage(getRandomMessage('lose_turn'), true);
                        endTurn();
                        break;
                    case 'hint':
                        const currentPuzzle = allPuzzles[hourlyPuzzleIndices[gameState.currentRound - 1]];
                        updateHostMessage(getRandomMessage('hint', {hint: currentPuzzle.hint}));
                        updateUI();
                        break;
                    case 'free_vowel':
                        gameState.freeVowels++;
                        updateHostMessage(getRandomMessage('free_vowel'), true);
                        updateUI();
                        break;
                    case 'bonus_points':
                        gameState.playerScore += result.value;
                        updateHostMessage(getRandomMessage('bonus_points', {value: result.value}), true);
                        updateUI();
                        break;
                    case 'express':
                        gameState.isExpressTurn = true;
                        gameState.currentSpinValue = 1000;
                        updateHostMessage(getRandomMessage('express'), true);
                        updateUI();
                        break;
                    case 'double_or_nothing':
                        handleDoubleOrNothing();
                        break;
                    default:
                        gameState.currentSpinValue = result.value;
                        gameState.awaitingConsonant = true;
                        updateHostMessage(getRandomMessage('spin_result', {value: result.value}), true);
                        updateUI();
                        break;
                }
            }

            async function handleDoubleOrNothing() {
                const roundWinnings = gameState.playerScore - gameState.roundStartScore;
                if (roundWinnings <= 0) {
                    updateHostMessage("<strong>DUPLA VAGY SEMMI</strong>, de nincs mit kock√°ztatni ebben a k√∂rben. Folytathatod.", true);
                    endTurn();
                    return;
                }
                
                try {
                    const choice = await showModal({
                        title: "Dupla vagy Semmi",
                        text: getRandomMessage('double_or_nothing_prompt', {points: roundWinnings}),
                        confirmText: "Kock√°ztatok!",
                        cancelText: "Nem merem"
                    });
                    
                    if (choice) {
                        if (Math.random() < 0.5) {
                            gameState.playerScore += roundWinnings;
                            updateHostMessage(getRandomMessage('double_win'), true);
                        } else {
                            gameState.playerScore -= roundWinnings;
                            updateHostMessage(getRandomMessage('double_lose'), true);
                        }
                    }
                } catch (e) { /* User cancelled */ }
                endTurn();
            }
            
            function handleLetterGuess(letter) {
                if (gameState.guessedLetters.includes(letter) || document.querySelector(`.alphabet-key[data-letter="${letter}"]`).disabled) return;
                
                const isVowel = VOWELS.includes(letter);
                
                if (isVowel) {
                    if(gameState.freeVowels > 0) {
                        gameState.freeVowels--;
                    } else {
                        gameState.playerScore -= VOWEL_COST;
                    }
                }
                
                gameState.guessedLetters.push(letter);
                
                const currentPuzzle = allPuzzles[hourlyPuzzleIndices[gameState.currentRound - 1]].puzzle.toUpperCase();
                const foundCount = (currentPuzzle.match(new RegExp(letter, "g")) || []).length;

                if (foundCount > 0) {
                    playSound('correct-sound');
                    document.querySelectorAll(`.puzzle-tile[data-letter="${letter}"]`).forEach(tile => tile.classList.add('revealed'));
                    if (isVowel) {
                        updateHostMessage(getRandomMessage('correct_vowel', {count: foundCount}));
                    } else {
                        const earnings = foundCount * gameState.currentSpinValue;
                        gameState.playerScore += earnings;
                        updateHostMessage(getRandomMessage('correct_consonant', {count: foundCount, earnings: earnings}));
                        if (!gameState.isExpressTurn) gameState.awaitingConsonant = false;
                    }
                } else {
                    updateHostMessage(getRandomMessage('wrong_letter'));
                    endTurn();
                }

                if (document.querySelectorAll('.puzzle-tile[data-letter]:not(.space .tile-inner)').length === document.querySelectorAll('.puzzle-tile.revealed').length) {
                    setTimeout(() => solvePuzzle(true), 1000);
                } else {
                    updateUI();
                }
            }
            
            async function solvePuzzle(autoSolve = false) {
                const puzzleData = allPuzzles[hourlyPuzzleIndices[gameState.currentRound - 1]];
                let attempt = '';

                if (!autoSolve) {
                    try {
                        attempt = await showModal({
                            title: 'Megfejt√©s', text: 'K√©rem a teljes megfejt√©st:', showInput: true
                        });
                        if (!attempt) return;
                    } catch { return; }
                } else {
                    attempt = puzzleData.puzzle;
                }

                if (attempt.toUpperCase().trim().replace(/\s+/g, ' ') === puzzleData.puzzle.toUpperCase()) {
                    playSound('win-sound');
                    document.querySelectorAll('.puzzle-tile[data-letter]:not(.revealed)').forEach((tile, index) => {
                        setTimeout(() => tile.classList.add('revealed'), index * 50);
                    });

                    updateHostMessage(getRandomMessage('solve_success'));
                    if (gameState.currentRound < gameState.totalRounds) {
                        setTimeout(() => startRound(false), 4000); 
                    } else {
                        setTimeout(() => gameWin(), 4000);
                    }
                } else {
                    updateHostMessage("Sajnos ez nem a helyes megfejt√©s!", true);
                    endTurn();
                }
            }

            function gameWin() {
                 updateHostMessage(getRandomMessage('game_win', {score: gameState.playerScore}), true);
                 // Ad√°s v√©gi √ºzenet
                 setTimeout(() => {
                    updateHostMessage(getRandomMessage('hour_end'), true);
                 }, 4000);
                 spinButton.disabled = true;
                 solveButton.disabled = true;
                 document.querySelectorAll('.alphabet-key').forEach(k => k.disabled = true);
            }

            function endTurn() {
                gameState.currentSpinValue = null;
                gameState.awaitingConsonant = false;
                gameState.isExpressTurn = false;
                setTimeout(() => {
                    if (document.querySelectorAll('.puzzle-tile[data-letter]:not(.space .tile-inner)').length !== document.querySelectorAll('.puzzle-tile.revealed').length && gameState.currentRound <= gameState.totalRounds) {
                        updateHostMessage(getRandomMessage('turn_end'));
                    }
                    updateUI();
                }, 3500); 
            }

            function startRound(isNewGame) {
                if (isNewGame) {
                    const { indices, hourId } = getHourlyPuzzles();
                    const lastPlayedHour = localStorage.getItem('lastPlayedHourId');
                    const lastScore = localStorage.getItem('lastScore');

                    if (lastPlayedHour && parseInt(lastPlayedHour, 10) === hourId) {
                        updateHostMessage(getRandomMessage('hour_end'), true);
                        scoreDisplay.textContent = `${lastScore || 0} pont`;
                        roundDisplay.textContent = `Fordul√≥k: ${PUZZLES_PER_HOUR}/${PUZZLES_PER_HOUR}`;
                        const date = new Date(hourId * 60 * 60 * 1000);
                        hourBlockDisplay.textContent = `Ad√°s: ${date.getHours()}:00 √≥rai blokk`;
                        puzzleBoard.innerHTML = '<div style="text-align:center; font-size: 1.2rem; color: white; padding: 2rem; line-height: 1.5;">A st√∫di√≥ jelenleg sz√ºnetet tart.<br>V√°rjuk vissza a k√∂vetkez≈ë ad√°sban!</div>';
                        alphabetPanel.innerHTML = '';
                        spinButton.disabled = true;
                        solveButton.disabled = true;
                        newGameButton.textContent = "√öj ad√°s keres√©se";
                        return;
                    }
                    localStorage.removeItem('lastPlayedHourId');
                    localStorage.removeItem('lastScore');

                    hourlyPuzzleIndices = indices;
                    resetGameState(true);
                    gameState.totalRounds = hourlyPuzzleIndices.length;
                    gameState.puzzleHourId = hourId;
                    
                } else {
                    resetGameState(false);
                }
                
                if (gameState.currentRound > gameState.totalRounds) {
                    localStorage.setItem('lastPlayedHourId', gameState.puzzleHourId.toString());
                    localStorage.setItem('lastScore', gameState.playerScore.toString());
                    gameWin();
                    return;
                }
                newGameButton.textContent = "√öj J√°t√©k";
                drawWheel(gameState.currentRound);
                setupPuzzleBoard();
                createAlphabetPanel();
                updateUI();
                updateHostMessage(getRandomMessage(gameState.currentRound === 1 && isNewGame ? 'start_game' : 'start_round', {round: gameState.currentRound}));
            }
            
            spinButton.addEventListener('click', togglePowerMeter);
            solveButton.addEventListener('click', () => solvePuzzle(false));
            newGameButton.addEventListener('click', () => {
                startRound(true);
            });

            startRound(true);
        });
    </script>
</body>
</html>
